function shop_item_init(e){for(var t=0;t<cache_keys.length;t++){var o=sel_cache[cache_keys[t]],i=Object.keys(o);if(parseInt(o.count)<parseInt(o.min))error_item[cache_keys[t]]=1,$(".cart-btn").addClass("weui-btn_disabled"),$(".tooltiptext").css("visibility","visible"),$(".tooltiptext").text(o.min+"杯起送，挑多几杯吧");else if(void 0!=o.multiple&&void 0!=o.box&&1==parseInt(o.multiple)){var a=getGCDLCM(o.box),s=a.GCD,l=parseInt(o.count)-parseInt(o.min);l>=0&&l%s!=0&&(error_item[cache_keys[t]]=1,$(".cart-btn").addClass("weui-btn_disabled"),$(".tooltiptext").css("visibility","visible"),$(".tooltiptext").text("满8/12/16杯才能下单哦~"))}for(j=0;j<i.length;j++){var r=i[j];r.length<20||(e||$(".number-"+r).text(o[r].num),parseInt(o[r].num)>0&&(addToCart(o[r].column_guid,r,o[r].price,o[r].num,o[r].name),$(".number-"+r).addClass("goods-has-number")))}}isEmpty(sel_cache)&&$(".cart-btn").addClass("weui-btn_disabled"),$(".cart-price").text(local_storage.price),local_storage.num_total&&$(".cart-count").text(local_storage.num_total)}function clear_storge(){local_storage.removeItem("sel_cache"),local_storage.removeItem("num_total"),local_storage.removeItem("price")}function addToCart(e,t,o,i,a){var s='<div class="weui-flex cart-goods-item goods-info" name="'+a+'" guid="'+t+'" price="'+o+'" id= "cart-item-'+t+'">                <div class="weui-flex__item">                    <div class="placeholder"><p class="cart-item-name">'+a+'</p></div>                </div>                <div>                    <div class="placeholder">                        <span class="item-minus item-change">                            <button class="weui-btn weui-btn_mini item-minus" column="'+e+'" item="'+t+'"><i class="iconfont icon-jianhao"></i></button>                        </span>                        <span class="goods-number number-'+t+'">'+i+'</span>                        <span class="item-plus item-change">                            <button class="weui-btn weui-btn_mini item-plus" column="'+e+'" item="'+t+'"><i class="iconfont icon-jiahao1"></i></button>                        </span>                    </div>                </div>            </div>';$(".cart-items").prepend(s)}function isEmpty(e){for(var t in e)return!1;return!0}function order_verification(e){if(!e){var t={status:-1,message:"订单为空"};return t}if(!e.address){var t={status:-2,message:"请填写配送地址。"};smoothScroll($(window),$("#address-panel").offset().top-100,200);var o=$("#address-panel").position();return $(".tooltiptext").css({top:o.top+6,right:15,visibility:"visible"}),$(".tooltiptext").text(t.message),t}if(!e.sendTime){var t={status:-3,message:"请选择配送时间"};smoothScroll($(window),$("#send-time-panel").offset().top-100,200);var o=$("#send-time-panel").position();return $(".tooltiptext").css({top:o.top+6,right:15,visibility:"visible"}),$(".tooltiptext").text(t.message),t}var t={status:0};return t}function smoothScroll(e,t,o){if(!(o<0)){var i=t-$(window).scrollTop(),a=i/o*10;this.scrollToTimerCache=setTimeout(function(){isNaN(parseInt(a,10))||(window.scrollTo(0,$(window).scrollTop()+a),smoothScroll(e,t,o-10))}.bind(this),10)}}function goTop(e,t){e=e||.1,t=t||6;var o=0,i=0,a=0,s=0,l=0,r=0;document.documentElement&&(o=document.documentElement.scrollLeft||0,i=document.documentElement.scrollTop||0),document.body&&(a=document.body.scrollLeft||0,s=document.body.scrollTop||0);var l=window.scrollX||0,r=window.scrollY||0,n=Math.max(o,Math.max(a,l)),c=Math.max(i,Math.max(s,r)),d=1+e;if(window.scrollTo(Math.floor(n/d),Math.floor(c/d)),n>0||c>0){var m="goTop("+e+", "+t+")";window.setTimeout(m,t)}}function close_toggle_modal(){var e=$(".togger-mask").parent();$(".togger-mask").hide(100),$(".tooltiptext").addClass("tooltip-position-menu"),$(".tooltiptext").removeClass("tooltip-position-cart"),$(".close-btn").hide(100),$(".cart-prompt").hide(100),$(".weui-tabbar").css("z-index",500),e.find(".weui-actionsheet").removeClass("weui-actionsheet_toggle"),$(".weui-tabbar").show(),myScroll&&(myScroll.destroy(),myScroll=null)}function settime(e){return 0==countdown?(e.removeAttr("disabled"),e.text("重新发送"),e.css({color:"#d4a77E"}),e.removeClass("weui-btn_disabled weui-btn_default"),countdown=60,!1):(e.attr("disabled",!0),e.text("正在获取("+countdown+")"),e.css({color:"#ccc"}),countdown--,void setTimeout(function(){settime(e)},1e3))}function isPhoneNum(){var e=$(".phonenum").val(),t=/^(((13[0-9]{1})|14[5|7]{1}|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/,o=$(".getVerificationCode"),i=$(".tel-warn"),a=$(".bind_mobile-btn");return t.test(e)?(o.removeAttr("disabled"),i.css("display","none"),a.removeAttr("disabled"),a.removeClass("weui-btn_default"),o.removeClass("weui-btn_disabled weui-btn_default"),!0):(o.attr("disabled",!0),i.css("display","block"),a.attr("disabled",!0),a.addClass("weui-btn_default"),!1)}function ScrollFix(e){var t,o;e=e||document.querySelector(e),e&&e.addEventListener("touchstart",function(i){t=i.touches[0].pageY,o=e.scrollTop,o<=0&&(e.scrollTop=1),o+e.offsetHeight>=e.scrollHeight&&(e.scrollTop=e.scrollHeight-e.offsetHeight-1)},!1)}function isSrc(e){var t="^((https|http|ftp|rtsp|mms)?://)?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})(:[0-9]{1,4})?((/?)|(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$",o=new RegExp(t);return!!o.test(e)}function getGCDLCM(str){var arr=eval("["+str+"]"),max=Math.max.apply(null,arr),min=Math.min.apply(null,arr),GCDLCM=new Object;GCDLCM.str=str,GCDLCM.num=arr.length;var i,j,ifstr="";for(j=0;j<arr.length;j++)ifstr+=arr[j]+"<1",j<arr.length-1&&(ifstr+="||");if(eval(ifstr))return GCDLCM.GCD=-1,GCDLCM.LCM=-1,GCDLCM;for(i=min;i>0;i--){for(ifstr="",j=0;j<arr.length;j++)ifstr+=arr[j]+"%"+i+"==0",j<arr.length-1&&(ifstr+="&&");if(eval(ifstr)){GCDLCM.GCD=i;break}}return GCDLCM}var local_storage=window.localStorage,sel_cache={},error_item={},myScroll=null,shopScroll=null,mobile_code={};local_storage.sel_cache&&(sel_cache=JSON.parse(local_storage.sel_cache));var cache_keys=Object.keys(sel_cache);$(function(){FastClick.attach(document.body),$(".back_up").on("click",function(e){goTop(1,1)}),$(".close-cart").on("click",function(e){close_toggle_modal()}),$("body").on("click",".close-icon-modal",function(e){close_toggle_modal()}),$(".menu-cart").on("click",function(e){close_toggle_modal(),$(".tooltiptext").addClass("tooltip-position-cart"),$(".tooltiptext").removeClass("tooltip-position-menu"),$(".shop-cart-content").addClass("weui-actionsheet_toggle"),$(".togger-mask").show(100),$(".cart-prompt").show(100),$(".weui-tabbar").hide(),shopScroll?setTimeout(function(){shopScroll.refresh()},0):shopScroll=new IScroll(".cart-iscroll",{mouseWheel:!0,checkDOMChanges:!0,click:!1})}),$("body").on("click",".item-minus",function(e){var t=$(this).attr("column"),o=$(this).attr("item"),i=$(this).attr("box"),a=$(this).attr("multiple"),s=parseInt($(".number-"+o).text());if(0!=s){var l=$(this).parents(".goods-info");if(s--,sel_cache[t].count--,0==s?($(".number-"+o).removeClass("goods-has-number"),$("#cart-item-"+o).remove(),delete sel_cache[t][o],0==sel_cache[t].count&&delete sel_cache[t]):sel_cache[t][o]={column_guid:t,num:s,box:i,multiple:a,name:l.attr("name"),price:l.attr("price")},!isEmpty(sel_cache[t])&&sel_cache[t].count<parseInt(sel_cache[t].min)&&sel_cache[t].count>0)error_item[t]=1,$(".cart-btn").addClass("weui-btn_disabled"),$(".tooltiptext").css("visibility","visible"),$(".tooltiptext").text(sel_cache[t].min+"杯起送，挑多几杯吧");else if(isEmpty(sel_cache[t])||void 0==sel_cache[t].multiple||void 0==sel_cache[t].box||1!=parseInt(sel_cache[t].multiple))error_item[t]&&delete error_item[t];else{var r=getGCDLCM(sel_cache[t].box),n=r.GCD,c=parseInt(sel_cache[t].count)-parseInt(sel_cache[t].min);c>=0&&(c%n!=0?(error_item[t]=1,$(".cart-btn").addClass("weui-btn_disabled"),$(".tooltiptext").css("visibility","visible"),$(".tooltiptext").text("满8/12/16杯才能下单哦~")):error_item[t]&&delete error_item[t])}isEmpty(error_item)&&!isEmpty(sel_cache)?$(".cart-btn").removeClass("weui-btn_disabled"):$(".cart-btn").addClass("weui-btn_disabled"),isEmpty(error_item)&&$(".tooltiptext").css("visibility","hidden"),local_storage.price=parseInt(local_storage.price)-parseInt(l.attr("price")),$(".cart-price").text(local_storage.price);var d=local_storage.num_total;local_storage.num_total=parseInt(d)-1,$(".cart-count").text(local_storage.num_total),local_storage.sel_cache=JSON.stringify(sel_cache),$(".number-"+o).text(s)}}),$("body").on("click",".item-plus",function(e){var t=$(this).attr("column"),o=$(this).attr("item"),i=$("#"+t).attr("box"),a=$("#"+t).attr("multiple"),s=parseInt($(".number-"+o).text()),l=$(this).parents(".goods-info");if(s=parseInt(s)+1,1==s&&addToCart(t,o,l.attr("price"),s,l.attr("name")),sel_cache[t])sel_cache[t].count++;else{var r=1;if($("#"+t).attr("min"))var r=$("#"+t).attr("min");name=$("#"+t).attr("name"),sel_cache[t]={count:s,min:r,box:i,multiple:a,name:name}}sel_cache[t][o]={column_guid:t,num:s,name:l.attr("name"),price:l.attr("price")};var n=l.attr("pre_sell"),c=l.attr("send_start_date"),d=!1;if(n&&c){var m=new Date(c.replace(/-/g,"/")),u=new Date;m>u&&(d=!0,$(".tooltiptext").text(l.attr("name")+"预售中，于"+c+"开始配送"),$(".tooltiptext").css("visibility","visible"))}if(sel_cache[t].count<parseInt(sel_cache[t].min))error_item[t]=1,$(".cart-btn").addClass("weui-btn_disabled"),$(".tooltiptext").css("visibility","visible"),$(".tooltiptext").text(sel_cache[t].min+"杯起送，挑多几杯吧");else if(void 0!=sel_cache[t].multiple&&void 0!=sel_cache[t].box&&1==parseInt(sel_cache[t].multiple)){var p=getGCDLCM(sel_cache[t].box),h=p.GCD,_=parseInt(sel_cache[t].count)-parseInt(sel_cache[t].min);_>=0&&(_%h!=0?(error_item[t]=1,$(".cart-btn").addClass("weui-btn_disabled"),$(".tooltiptext").css("visibility","visible"),$(".tooltiptext").text("满8/12/16杯才能下单哦~")):error_item[t]&&delete error_item[t])}else error_item[t]&&delete error_item[t];isEmpty(error_item)&&($(".cart-btn").removeClass("weui-btn_disabled"),$(".tooltiptext").css("visibility","hidden")),d&&($(".tooltiptext").css("visibility","visible"),$(".tooltiptext").text(l.attr("name")+"预售中，于"+c+"开始配送")),local_storage.price?local_storage.price=parseInt(local_storage.price)+parseInt(l.attr("price")):local_storage.price=parseInt(l.attr("price")),$(".cart-price").text(local_storage.price);var g=local_storage.num_total;g?local_storage.num_total=parseInt(g)+1:local_storage.num_total=1,$(".cart-count").text(local_storage.num_total),local_storage.sel_cache=JSON.stringify(sel_cache),$(".number-"+o).text(s),$(".number-"+o).addClass("goods-has-number")}),$(".togger-mask").on("click",function(e){close_toggle_modal(),$(".cart-tooltip").removeClass("tooltip-position-menu")}),$(".close-btn").on("click",function(e){close_toggle_modal(),$(".cart-tooltip").removeClass("tooltip-position-menu")}),$(".cart-btn").on("click",function(e){isEmpty(error_item)&&(isEmpty(sel_cache)||("send_yourself"==$(this).attr("params")&&$.post("/Shop/Index/add_to_card_handle",sel_cache,function(e){0==e.status?window.location.href="/Shop/Index/cart":e.status==-30004?"none"==$("#Binding-mobile-phone").css("display")&&($("#Binding-mobile-phone").show(100),$(".bind_mobile-btn").addClass("weui-btn_disabled weui-btn_default"),$("#getVerificationCode").addClass("weui-btn_disabled weui-btn_default"),$(".verificationCode").attr("disabled",!0),close_toggle_modal()):($(".error-message").text(e.message),$(".error-dialog").show(),$(".index-dialog-btn").addClass("need-clear"),close_toggle_modal())}),"send_friend"==$(this).attr("params")&&$.post("/Shop/Index/add_to_card_handle",sel_cache,function(e){0==e.status?window.location.href="/Shop/Index/send_friend":e.status==-30004?"none"==$("#Binding-mobile-phone").css(display)&&($("#Binding-mobile-phone").show(100),$(".bind_mobile-btn").addClass("weui-btn_disabled weui-btn_default"),$("#getVerificationCode").addClass("weui-btn_disabled weui-btn_default"),$(".verificationCode").attr("disabled",!0),close_toggle_modal()):($(".error-message").text(e.message),$(".error-dialog").show(),$(".index-dialog-btn").addClass("need-clear"),close_toggle_modal())})))}),$(".btn-clear-cart").on("click",function(){clear_storge(),window.location.reload()}),$(".index-dialog-btn").on("click",function(e){$(this).hasClass("need-clear")&&(clear_storge(),window.location.reload()),$(".error-dialog").hide()})}),$(".scrollTo").on("click",function(){smoothScroll($(window),$($(e.currentTarget).attr("href")).offset().top,200)}),Date.prototype.Format=function(e){var t=e,o=["日","一","二","三","四","五","六"];return t=t.replace(/yyyy|YYYY/,this.getFullYear()),t=t.replace(/yy|YY/,this.getYear()%100>9?(this.getYear()%100).toString():"0"+this.getYear()%100),t=t.replace(/MM/,this.getMonth()>9?this.getMonth().toString():"0"+this.getMonth()),t=t.replace(/M/g,this.getMonth()),t=t.replace(/w|W/g,o[this.getDay()]),t=t.replace(/dd|DD/,this.getDate()>9?this.getDate().toString():"0"+this.getDate()),t=t.replace(/d|D/g,this.getDate()),t=t.replace(/hh|HH/,this.getHours()>9?this.getHours().toString():"0"+this.getHours()),t=t.replace(/h|H/g,this.getHours()),t=t.replace(/mm/,this.getMinutes()>9?this.getMinutes().toString():"0"+this.getMinutes()),t=t.replace(/m/g,this.getMinutes()),t=t.replace(/ss|SS/,this.getSeconds()>9?this.getSeconds().toString():"0"+this.getSeconds()),t=t.replace(/s|S/g,this.getSeconds())};var countdown=60;$(".phonenum").on("change",function(){var e=$(this).attr("param-name");mobile_code[e]=$(this).val()}),$(".verificationCode").on("change",function(){var e=$(this).attr("param-name");mobile_code[e]=$(this).val()}),$("#getVerificationCode").on("click",function(){return document.getElementById("getVerificationCode").addEventListener("click",isPhoneNum),""==$(".phonenum").val()?($("#getVerificationCode").attr("disabled",!0),!1):($(".verificationCode").removeAttr("disabled"),settime($("#getVerificationCode")),void $.post("/Shop/Index/get_to_code",mobile_code,function(e){0!=e.status&&($(".error-message").text(e.message),$(".error-dialog").show(),countdown=0)}))}),$(".bind_mobile-cancle-btn").on("click",function(){$("#Binding-mobile-phone").hide()}),$(".bind_mobile-btn").on("click",function(){return""==$(".phonenum").val()?($(".getVerificationCode").attr("disabled",!0),$(".bind_mobile-btn").attr("disabled",!0),!1):""==$(".verificationCode").val()?($("#bind_mobile-btn").attr("disabled",!0),!1):($.post("/Shop/Index/add_to_tel",mobile_code,function(e){0!=e.status?($(".error-message").text(e.message),$(".error-dialog").show(),countdown=0):$.post("/Shop/Index/add_to_card_handle",sel_cache,function(e){0==e.status?($(".succeedToast").show(),$("#Binding-mobile-phone").hide(),window.location.href="/Shop/Index/cart"):($(".error-message").text(e.message),$(".error-dialog").show(),$(".index-dialog-btn").addClass("need-clear"),close_toggle_modal())})}),void document.getElementById("getVerificationCode").removeEventListener("click",isPhoneNum))});var scrollable=document.getElementById("scrollable");new ScrollFix(scrollable);